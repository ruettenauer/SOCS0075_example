lwd = 1,
position = position_dodge(width = 0.9)) +
geom_point(aes(x = term,
y = estimate,
shape = country,
fill = country,
group = country),
stroke = 2.5,
size = 5, position = position_dodge(width = 0.9), color = "black") +
# geom_point(data = ref,
#            aes(x = term,
#                y = estimate),
#            size=4, shape = 21, fill = "gray80") +
ggtitle("") +
xlab("") +
ylab("Coefficients of Median Quantile Regression") +
scale_shape_manual("", values = c(21, 24, 25), na.translate = F) +
scale_color_grey("", end = 0.6, na.translate = F) +
scale_fill_viridis_d("", end = 0.9, begin = 0.4, na.translate = F, option = "C") +
# scale_alpha_discrete(na.translate=FALSE,
#                      range=c(0.35,1),
#                      guide="none")+
# scale_x_discrete(position = "top", expand = c(0,0.8)) +
# scale_y_continuous(breaks = seq(-25,20,5),
#                    limits = c(-30,25))+
theme_classic(base_size = 14) +
theme(axis.text = element_text(size = 16, face = "bold"),
strip.text = element_text(size = 16, face = "bold"),
axis.title = element_text(size = 16, face = "bold"),
legend.text = element_text(size = 16, face = "bold"),
legend.title = element_text(size = 16, face = "bold"),
legend.position = "right",
legend.direction="vertical",
legend.spacing.y = unit(0.5,"cm"),
panel.grid.major.x = element_line(colour = "gray50",size = 0.6),
panel.spacing.y = unit(0,"lines"))+
coord_flip()+
guides(fill=guide_legend(byrow = TRUE),
color=guide_legend(byrow = TRUE),
shape=guide_legend(byrow = TRUE))
pl
results.df$conf.low <- results.df$Value - interval * results.df$Std..Error
results.df$conf.high <- results.df$Value + interval * results.df$Std..Error
### Confidence intervals
# Re-calculate lb and up
interval  <-  -qnorm((1-0.95)/2)
results.df$conf.low <- results.df$Value - interval * results.df$Std..Error
results.df$conf.high <- results.df$Value + interval * results.df$Std..Error
pl <- ggplot(results.df,
aes(x = term, y = Value)) +
# geom_rect(data = subset(aux, attribute %in% c("Green\nspaces","Industry","Rent")),
#           fill="gray50",xmin=-Inf,xmax=Inf,ymin=-Inf,ymax=Inf,alpha=0.4)+
geom_hline(yintercept = 0,
colour = gray(1/2), lwd = 1.5) +
geom_linerange(aes(x = term,
ymin = conf.low,
ymax = conf.high,
group = country),
lwd = 1,
position = position_dodge(width = 0.9)) +
geom_point(aes(x = term,
y = estimate,
shape = country,
fill = country,
group = country),
stroke = 2.5,
size = 5, position = position_dodge(width = 0.9), color = "black") +
# geom_point(data = ref,
#            aes(x = term,
#                y = estimate),
#            size=4, shape = 21, fill = "gray80") +
ggtitle("") +
xlab("") +
ylab("Coefficients of Median Quantile Regression") +
scale_shape_manual("", values = c(21, 24, 25), na.translate = F) +
scale_color_grey("", end = 0.6, na.translate = F) +
scale_fill_viridis_d("", end = 0.9, begin = 0.4, na.translate = F, option = "C") +
# scale_alpha_discrete(na.translate=FALSE,
#                      range=c(0.35,1),
#                      guide="none")+
# scale_x_discrete(position = "top", expand = c(0,0.8)) +
# scale_y_continuous(breaks = seq(-25,20,5),
#                    limits = c(-30,25))+
theme_classic(base_size = 14) +
theme(axis.text = element_text(size = 16, face = "bold"),
strip.text = element_text(size = 16, face = "bold"),
axis.title = element_text(size = 16, face = "bold"),
legend.text = element_text(size = 16, face = "bold"),
legend.title = element_text(size = 16, face = "bold"),
legend.position = "right",
legend.direction="vertical",
legend.spacing.y = unit(0.5,"cm"),
panel.grid.major.x = element_line(colour = "gray50",size = 0.6),
panel.spacing.y = unit(0,"lines"))+
coord_flip()+
guides(fill=guide_legend(byrow = TRUE),
color=guide_legend(byrow = TRUE),
shape=guide_legend(byrow = TRUE))
pl
pl <- ggplot(results.df,
aes(x = term, y = Value)) +
# geom_rect(data = subset(aux, attribute %in% c("Green\nspaces","Industry","Rent")),
#           fill="gray50",xmin=-Inf,xmax=Inf,ymin=-Inf,ymax=Inf,alpha=0.4)+
geom_hline(yintercept = 0,
colour = gray(1/2), lwd = 1.5) +
geom_linerange(aes(x = term,
ymin = conf.low,
ymax = conf.high,
group = country),
lwd = 1,
position = position_dodge(width = 0.9)) +
geom_point(aes(x = term,
y = Value,
shape = country,
fill = country,
group = country),
stroke = 2.5,
size = 5, position = position_dodge(width = 0.9), color = "black") +
# geom_point(data = ref,
#            aes(x = term,
#                y = estimate),
#            size=4, shape = 21, fill = "gray80") +
ggtitle("") +
xlab("") +
ylab("Coefficients of Median Quantile Regression") +
scale_shape_manual("", values = c(21, 24, 25), na.translate = F) +
scale_color_grey("", end = 0.6, na.translate = F) +
scale_fill_viridis_d("", end = 0.9, begin = 0.4, na.translate = F, option = "C") +
# scale_alpha_discrete(na.translate=FALSE,
#                      range=c(0.35,1),
#                      guide="none")+
# scale_x_discrete(position = "top", expand = c(0,0.8)) +
# scale_y_continuous(breaks = seq(-25,20,5),
#                    limits = c(-30,25))+
theme_classic(base_size = 14) +
theme(axis.text = element_text(size = 16, face = "bold"),
strip.text = element_text(size = 16, face = "bold"),
axis.title = element_text(size = 16, face = "bold"),
legend.text = element_text(size = 16, face = "bold"),
legend.title = element_text(size = 16, face = "bold"),
legend.position = "right",
legend.direction="vertical",
legend.spacing.y = unit(0.5,"cm"),
panel.grid.major.x = element_line(colour = "gray50",size = 0.6),
panel.spacing.y = unit(0,"lines"))+
coord_flip()+
guides(fill=guide_legend(byrow = TRUE),
color=guide_legend(byrow = TRUE),
shape=guide_legend(byrow = TRUE))
pl
pl <- ggplot(results.df,
aes(x = term, y = Value)) +
# geom_rect(data = subset(aux, attribute %in% c("Green\nspaces","Industry","Rent")),
#           fill="gray50",xmin=-Inf,xmax=Inf,ymin=-Inf,ymax=Inf,alpha=0.4)+
geom_hline(yintercept = 0,
colour = gray(1/2), lwd = 1.5, linetype = "dashed") +
geom_linerange(aes(x = term,
ymin = conf.low,
ymax = conf.high,
group = country),
lwd = 1,
position = position_dodge(width = 0.7)) +
geom_point(aes(x = term,
y = Value,
shape = country,
fill = country,
group = country),
stroke = 2.5,
size = 5, position = position_dodge(width = 0.7), color = "black") +
# geom_point(data = ref,
#            aes(x = term,
#                y = estimate),
#            size=4, shape = 21, fill = "gray80") +
ggtitle("") +
xlab("") +
ylab("Coefficients of Median Quantile Regression") +
scale_shape_manual("", values = c(21, 24, 25), na.translate = F) +
scale_color_grey("", end = 0.6, na.translate = F) +
scale_fill_viridis_d("", end = 0.9, begin = 0.4, na.translate = F, option = "C") +
# scale_alpha_discrete(na.translate=FALSE,
#                      range=c(0.35,1),
#                      guide="none")+
# scale_x_discrete(position = "top", expand = c(0,0.8)) +
# scale_y_continuous(breaks = seq(-25,20,5),
#                    limits = c(-30,25))+
theme_classic(base_size = 14) +
theme(axis.text = element_text(size = 16, face = "bold"),
strip.text = element_text(size = 16, face = "bold"),
axis.title = element_text(size = 16, face = "bold"),
legend.text = element_text(size = 16, face = "bold"),
legend.title = element_text(size = 16, face = "bold"),
legend.position = "right",
legend.direction="vertical",
legend.spacing.y = unit(0.5,"cm"),
panel.grid.major.x = element_line(colour = "gray50",size = 0.6),
panel.spacing.y = unit(0,"lines"))+
coord_flip()+
guides(fill=guide_legend(byrow = TRUE),
color=guide_legend(byrow = TRUE),
shape=guide_legend(byrow = TRUE))
pl
pl <- ggplot(results.df,
aes(x = term, y = Value)) +
# geom_rect(data = subset(aux, attribute %in% c("Green\nspaces","Industry","Rent")),
#           fill="gray50",xmin=-Inf,xmax=Inf,ymin=-Inf,ymax=Inf,alpha=0.4)+
geom_hline(yintercept = 0,
colour = gray(1/2), lwd = 1.5, linetype = "dashed") +
geom_linerange(aes(x = term,
ymin = conf.low,
ymax = conf.high,
group = country),
lwd = 1,
position = position_dodge(width = 0.7)) +
geom_point(aes(x = term,
y = Value,
shape = country,
fill = country,
group = country),
stroke = 2,
size = 4, position = position_dodge(width = 0.7), color = "black") +
# geom_point(data = ref,
#            aes(x = term,
#                y = estimate),
#            size=4, shape = 21, fill = "gray80") +
ggtitle("") +
xlab("") +
ylab("Coefficients of Median Quantile Regression") +
scale_shape_manual("", values = c(21, 24, 25), na.translate = F) +
scale_color_grey("", end = 0.6, na.translate = F) +
scale_fill_viridis_d("", end = 0.9, begin = 0.4, na.translate = F, option = "C") +
# scale_alpha_discrete(na.translate=FALSE,
#                      range=c(0.35,1),
#                      guide="none")+
# scale_x_discrete(position = "top", expand = c(0,0.8)) +
# scale_y_continuous(breaks = seq(-25,20,5),
#                    limits = c(-30,25))+
theme_classic(base_size = 14) +
theme(axis.text = element_text(size = 16, face = "bold"),
strip.text = element_text(size = 16, face = "bold"),
axis.title = element_text(size = 16, face = "bold"),
legend.text = element_text(size = 16, face = "bold"),
legend.title = element_text(size = 16, face = "bold"),
legend.position = "right",
legend.direction="vertical",
legend.spacing.y = unit(0.5,"cm"),
panel.grid.major.x = element_line(colour = "gray50",size = 0.6),
panel.spacing.y = unit(0,"lines"))+
coord_flip()+
guides(fill=guide_legend(byrow = TRUE),
color=guide_legend(byrow = TRUE),
shape=guide_legend(byrow = TRUE))
pl
pl <- ggplot(results.df,
aes(x = term, y = Value)) +
# geom_rect(data = subset(aux, attribute %in% c("Green\nspaces","Industry","Rent")),
#           fill="gray50",xmin=-Inf,xmax=Inf,ymin=-Inf,ymax=Inf,alpha=0.4)+
geom_hline(yintercept = 0,
colour = gray(1/2), lwd = 1.5, linetype = "dashed") +
geom_linerange(aes(x = term,
ymin = conf.low,
ymax = conf.high,
group = country),
lwd = 1,
position = position_dodge(width = 0.7)) +
geom_point(aes(x = term,
y = Value,
shape = country,
fill = country,
group = country),
stroke = 2,
size = 4, position = position_dodge(width = 0.7), color = "black") +
# geom_point(data = ref,
#            aes(x = term,
#                y = estimate),
#            size=4, shape = 21, fill = "gray80") +
ggtitle("") +
xlab("") +
ylab("Coefficients of Median Quantile Regression") +
scale_shape_manual("", values = c(21, 24, 25), na.translate = F) +
scale_color_grey("", end = 0.6, na.translate = F) +
scale_fill_viridis_d("", end = 0.9, begin = 0.4, na.translate = F, option = "C") +
# scale_alpha_discrete(na.translate=FALSE,
#                      range=c(0.35,1),
#                      guide="none")+
# scale_x_discrete(position = "top", expand = c(0,0.8)) +
# scale_y_continuous(breaks = seq(-25,20,5),
#                    limits = c(-30,25))+
theme_classic(base_size = 14) +
theme(axis.text = element_text(size = 16, face = "bold"),
strip.text = element_text(size = 16, face = "bold"),
axis.title = element_text(size = 16, face = "bold"),
legend.text = element_text(size = 16, face = "bold"),
legend.title = element_text(size = 16, face = "bold"),
legend.position = "right",
legend.direction="vertical",
legend.spacing.y = unit(0.5,"cm"),
panel.grid.major.x = element_line(colour = "gray50",size = 0.6),
panel.spacing.y = unit(0,"lines"))+
coord_flip()+
guides(fill=guide_legend(byrow = TRUE, reverse = TRUE),
color=guide_legend(byrow = TRUE, reverse = TRUE),
shape=guide_legend(byrow = TRUE, reverse = TRUE))
pl
?png
pl <- ggplot(results.df,
aes(x = term, y = Value)) +
# geom_rect(data = subset(aux, attribute %in% c("Green\nspaces","Industry","Rent")),
#           fill="gray50",xmin=-Inf,xmax=Inf,ymin=-Inf,ymax=Inf,alpha=0.4)+
geom_hline(yintercept = 0,
colour = gray(1/2), lwd = 1.5, linetype = "dashed") +
geom_linerange(aes(x = term,
ymin = conf.low,
ymax = conf.high,
group = country),
lwd = 1,
position = position_dodge(width = 0.7)) +
geom_point(aes(x = term,
y = Value,
shape = country,
fill = country,
group = country),
stroke = 2,
size = 4, position = position_dodge(width = 0.7), color = "black") +
# geom_point(data = ref,
#            aes(x = term,
#                y = estimate),
#            size=4, shape = 21, fill = "gray80") +
ggtitle("") +
xlab("") +
ylab("Coefficients of Median Quantile Regression") +
scale_shape_manual("", values = c(21, 24, 25), na.translate = F) +
scale_color_grey("", end = 0.6, na.translate = F) +
scale_fill_viridis_d("", end = 0.9, begin = 0.4, na.translate = F, option = "C") +
# scale_alpha_discrete(na.translate=FALSE,
#                      range=c(0.35,1),
#                      guide="none")+
# scale_x_discrete(position = "top", expand = c(0,0.8)) +
# scale_y_continuous(breaks = seq(-25,20,5),
#                    limits = c(-30,25))+
theme_classic(base_size = 14) +
theme(axis.text = element_text(size = 16, face = "bold", color = "black"),
strip.text = element_text(size = 16, face = "bold"),
axis.title = element_text(size = 16, face = "bold"),
legend.text = element_text(size = 16, face = "bold"),
legend.title = element_text(size = 16, face = "bold"),
legend.position = "right",
legend.direction="vertical",
legend.spacing.y = unit(0.5,"cm"),
panel.grid.major.x = element_line(colour = "gray50",size = 0.6),
panel.spacing.y = unit(0,"lines"))+
coord_flip()+
guides(fill=guide_legend(byrow = TRUE, reverse = TRUE),
color=guide_legend(byrow = TRUE, reverse = TRUE),
shape=guide_legend(byrow = TRUE, reverse = TRUE))
png(filename = "Three_countries.png",
width = 12, height = 8, units = "in", res = 300,
type = "cairo")
pl
dev.off()
pl <- ggplot(results.df,
aes(x = term, y = Value)) +
# geom_rect(data = subset(aux, attribute %in% c("Green\nspaces","Industry","Rent")),
#           fill="gray50",xmin=-Inf,xmax=Inf,ymin=-Inf,ymax=Inf,alpha=0.4)+
geom_hline(yintercept = 0,
colour = "black", lwd = 1.5, linetype = "dashed") +
geom_linerange(aes(x = term,
ymin = conf.low,
ymax = conf.high,
group = country),
lwd = 1,
position = position_dodge(width = 0.7)) +
geom_point(aes(x = term,
y = Value,
shape = country,
fill = country,
group = country),
stroke = 2,
size = 4, position = position_dodge(width = 0.7), color = "black") +
# geom_point(data = ref,
#            aes(x = term,
#                y = estimate),
#            size=4, shape = 21, fill = "gray80") +
ggtitle("") +
xlab("") +
ylab("Coefficients of Median Quantile Regression") +
scale_shape_manual("", values = c(21, 24, 25), na.translate = F) +
scale_color_grey("", end = 0.6, na.translate = F) +
scale_fill_viridis_d("", end = 0.9, begin = 0.4, na.translate = F, option = "C") +
# scale_alpha_discrete(na.translate=FALSE,
#                      range=c(0.35,1),
#                      guide="none")+
# scale_x_discrete(position = "top", expand = c(0,0.8)) +
# scale_y_continuous(breaks = seq(-25,20,5),
#                    limits = c(-30,25))+
theme_classic(base_size = 14) +
theme(axis.text = element_text(size = 16, face = "bold", color = "black"),
strip.text = element_text(size = 16, face = "bold"),
axis.title = element_text(size = 16, face = "bold"),
legend.text = element_text(size = 16, face = "bold"),
legend.title = element_text(size = 16, face = "bold"),
legend.position = "right",
legend.direction="vertical",
legend.spacing.y = unit(0.5,"cm"),
panel.grid.major.x = element_line(colour = "gray50",size = 0.6),
panel.spacing.y = unit(0,"lines"))+
coord_flip()+
guides(fill=guide_legend(byrow = TRUE, reverse = TRUE),
color=guide_legend(byrow = TRUE, reverse = TRUE),
shape=guide_legend(byrow = TRUE, reverse = TRUE))
png(filename = "Three_countries.png",
width = 12, height = 8, units = "in", res = 300,
type = "cairo")
pl
dev.off()
?rq
### Loop over
for(c in countries){
country <- names(countries)[which(countries == c)]
print(country)
for(i in vars){
print(i)
oo <- which(data.df$country == c)
fm <- paste(outcome, paste(unlist(i), collapse = " + "), sep = " ~ ")
rqfit <- rq(fm, data = data.df[oo, ], ci = FALSE)
print(summary(rqfit))
res <- data.frame(summary(rqfit)$coefficients[-1, , drop = FALSE])
res$var <- rownames(res)
res$country <- country
if(i[1] == unlist(vars[1]) & c == countries[1]){
results.df <- res
}else{
results.df <- rbind(results.df, res)
}
}
}
countries <- c(276, 578, 840)
### Loop over
for(c in countries){
country <- names(countries)[which(countries == c)]
print(country)
for(i in vars){
print(i)
oo <- which(data.df$country == c)
fm <- paste(outcome, paste(unlist(i), collapse = " + "), sep = " ~ ")
rqfit <- rq(fm, data = data.df[oo, ], ci = FALSE)
print(summary(rqfit))
res <- data.frame(summary(rqfit)$coefficients[-1, , drop = FALSE])
res$var <- rownames(res)
res$country <- country
if(i[1] == unlist(vars[1]) & c == countries[1]){
results.df <- res
}else{
results.df <- rbind(results.df, res)
}
}
}
summary(rqfit)
test <- summary(rqfit)
rqfit$method
coefficients(rqfit)
rqfit$dual
rqfit$xlevels
i
i = vars[1]
rqfit_weird <- rqfit
rqfit <- rq(fm, data = data.df[oo, ], ci = FALSE)
rqfit
oo <- which(data.df$country == c)
fm <- paste(outcome, paste(unlist(i), collapse = " + "), sep = " ~ ")
rqfit <- rq(fm, data = data.df[oo, ], ci = FALSE)
rqfit
rqfit$method
### Loop over
for(c in countries){
country <- names(countries)[which(countries == c)]
print(country)
for(i in vars){
print(i)
oo <- which(data.df$country == c)
fm <- paste(outcome, paste(unlist(i), collapse = " + "), sep = " ~ ")
rqfit <- rq(fm, data = data.df[oo, ], ci = TRUE)
print(summary(rqfit))
res <- data.frame(summary(rqfit)$coefficients[-1, , drop = FALSE])
res$var <- rownames(res)
res$country <- country
if(i[1] == unlist(vars[1]) & c == countries[1]){
results.df <- res
}else{
results.df <- rbind(results.df, res)
}
}
}
c
i
View(results.df)
View(res)
?summary.rq
test <- summary(rqfit)
View(test)
summary(rqfit, se = "rank")
summary(rqfit, se = "iid")
?position_dodge
?scale_fill_viridis_d
unlist(names(countries)
)
?facet_wrap
results.df$group <- ifelse(results.df$var %in% unlist(group1), 0, 1)
### Grouping
group1 <- list(c("Female"),
c("< 40 years", "51-60 years"),
c("Immigrant"),
c("Couple", "Couple w children", "Single parent"))
